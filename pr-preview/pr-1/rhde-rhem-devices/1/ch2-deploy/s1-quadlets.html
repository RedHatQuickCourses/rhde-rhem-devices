<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Red Hat Edge Manager Services and Installation :: Deploying Red Hat Edge Manager and Managing Edge Devices</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="s2-install-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Deploying Red Hat Edge Manager and Managing Edge Devices</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-rhem-devices/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhde-rhem-devices" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Deploying Red Hat Edge Manager and Managing Edge Devices</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-intro/index.html">Introduction to Red Hat Edge Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s1-architecture.html">Managing Edge Devices with Red Hat Edge Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s3-classroom-lab.html">Lab: Prepare to Install Red Hat Edge Manager</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Install Red Hat Edge Manager as Quadlets</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s1-quadlets.html">Red Hat Edge Manager Services and Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-install-lab.html">Lab: Install Red Hat Edge Manager Standalone</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-enroll/index.html">Add Edge Devices to Red Hat Edge Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-enroll/s1-enroll.html">Enroll Edge Devices in RHEM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-enroll/s2-enroll-lab.html">Lab: Enroll Edge Devices Using Late Binding</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-manage/index.html">Manage Edge Devices with Red Hat Edge Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-manage/s1-manage.html">Manage Edge Devices with Red Hat Edge Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-manage/s2-manage-lab.html">Lab: Configure Edge Devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-manage/s3-update-lab.html">Lab: Update Edge Devices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch5-decomission/index.html">Remove Edge Devices from Red Hat Edge Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch5-decomission/s1-delete.html">Decommission and Delete Edge Devices with RHEM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch5-decomission/s2-delete-lab.html">Lab: Decommission and Delete Edge Devices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Deploying Red Hat Edge Manager and Managing Edge Devices</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Deploying Red Hat Edge Manager and Managing Edge Devices</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Deploying Red Hat Edge Manager and Managing Edge Devices</a></li>
    <li><a href="index.html">Install Red Hat Edge Manager as Quadlets</a></li>
    <li><a href="s1-quadlets.html">Red Hat Edge Manager Services and Installation</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Red Hat Edge Manager Services and Installation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>9 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Describe the main services that comprise Red Hat Edge Manager and how to deploy them as quadlets in RHEL servers, without dependencies on external services such as ACM, AAP, or Keycloack.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Work in progress
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As we already say in the previous chapter, Red Hat Edge Manager (RHEM) is based on the Flight Control open source project and is composed of two main pieces: an RHEM server, which runs a collection of microservices, fronted by an API server, and a RHEM agent, which runs on individual managed devices.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../ch1-intro/_images/agent-vs-server.svg" alt="agent vs server">
</div>
</div>
<div class="paragraph">
<p>You manage edge devices by making changes to the state of devices and fleets, using the RHEM API.
The RHEM agent observes the state stored on the server and the state of the device itself, reconcilling any differences.</p>
</div>
<div class="paragraph">
<p>There are many ways of deploying the RHEM microservices, and this course focuses on installing RHEM direclty on RHEL servers.
In this kind of deployment, RHEM microservices run as Podman containers, managed by the System Daemon (Systemd) using quadlets.</p>
</div>
<div class="paragraph">
<p>Before describing how to install RHEM services and quadlets on a RHEL server, let&#8217;s take a closer look at the RHEM architecture and its microservices.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_command_line_web_interfaces_and_agents"><a class="anchor" href="#_api_command_line_web_interfaces_and_agents"></a>API, command-line, web interfaces, and agents.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Though you could interact directly with the RHEM API, and there is even an <a href="https://galaxy.ansible.com/ui/repo/published/flightctl/core/docs/" target="_blank" rel="noopener">Ansible content collection</a> that does it, you would usually interact with RHEM by using either its command-line interface (CLI), provided by the <code>flightctl</code> command, or its web user interface (UI).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/RHEM-arch.svg" alt="RHEM arch">
</div>
<div class="title">Figure 1. High-level architecture of RHEM</div>
</div>
<div class="paragraph">
<p>The CLI has native ports for all major operating system, and the majority of tasks can be performed using either the CLI or the web UI.
As expected, the web UI offers ease of use, while the CLI offers scriptability.</p>
</div>
<div class="paragraph">
<p>If you install RHEM on RHEL, the web UI runs in the same server host as the RHEM API, but if you install RHEM on OpenShift, them the UI and microservices could run in different cluster nodes, as with any other application deployed on Kubernetes.</p>
</div>
<div class="paragraph">
<p>The RHEM microservices use a PostgreSQL relational database for persisting device state and its API resources.
They can also be configured with a number of different authentication, authorization, certificate, and configuration providers.</p>
</div>
<div class="paragraph">
<p>Configuration of the RHEM microservices is not usually done using its API, but by editing configuration files (if RHEM is deployed on RHEL) or Kubernetes resources (if RHEM is deployed on OpenShift).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This course does not teach how to configure different providers and other aspects of RHEM microservices.
It sticks to the installation defaults, which use Linux PAM for authentication and authorization, and a self-signed certificate.
This course focuses on using the RHEM API to manage devices.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on the authentication provider, it may not be possible to authenticate to RHEM using the CLI. In that case, the CLI can invoke a web browser to perform authentication and them use the returned token.</p>
</div>
<div class="paragraph">
<p>RHEM agents running on managed devices also invoke the RHEM API, but using a different entrypoint than the CLI and web UI do, and authenticate using a certificate generated at device enrollment time.
All communication between a RHEM agent and the RHEM API is secured using mTLS.</p>
</div>
<div class="paragraph">
<p>RHEM agents start network connections to the RHEM API, in a pull approach.
A RHEM server does not start network connections to aggents, which would be a push approach.
The pull approach enables deploying managed devices at edge sites which use private IP address ranges and rely on network address transation (NAT) to access external network resources and the internet.
It even enables edge sites using cheap broadband network connections, similar to redidencial broadband internet.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rhem_microservices"><a class="anchor" href="#_rhem_microservices"></a>RHEM microservices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RHEM runs a number of microservices, each on its own container, including a few optional observability microservices.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/RHEM-components.svg" alt="RHEM components">
</div>
<div class="title">Figure 2. RHEM microservices</div>
</div>
<div class="paragraph">
<p>If you deploy RHEM on RHEL, each microservice becomes a System Daemon (Systemd) service unit, as well as their supporting services.
The PostgreSQL database corresponds to the <code>flightctl-db</code> service and container, and the Redis cache corresponds to the <code>flightctl-kv</code> service and container.</p>
</div>
<div class="paragraph">
<p>There may be a few service units and containers not included in the previous diagram, for example a service that provides downloads of the RHEM CLI. Tasks such as initializing the RHEM database, migrating its schema during RHEM version updates, or generating TLS certificates for acessing RHEM API access, are also performed by containers running from one-shot Systemd units.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pam_authentication_with_rhem"><a class="anchor" href="#_pam_authentication_with_rhem"></a>PAM authentication with RHEM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the simplest deployment of standalone RHEM on RHEM, a special microservice called <code>flightctl-pam-issuer</code> runs an OpenID Connect (ODIC) provider based on Linux PAM.</p>
</div>
<div class="paragraph">
<p>Using its default configuation, the PAM issuer service uses UNIX passwd, shadow, and group files to manage authentication and authorization for the RHEM API.</p>
</div>
<div class="paragraph">
<p>The PAM issuer does not use the user and group files from its host RHEL server, but contains its own copy of these files.
You must manage these files inside the container, by using standard Linux tools such as the <code>useradd</code> command in the container namespaces, for example with <code>podman exec</code>.
The default configuration makes the Linux users of the PAM issuer container independent of the Linux users of its host, so that a RHEM user does not get unintended console or SSH access to a RHEM server host.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The recommended approach for a production-grade deployment of RHEM is configuring an ODIC provider which connects to an OAuth-based enterprise or cloud identity management system, such as Red Hat build of Keycloack, Microsoft EntraID, Auth0 by Okta, or Google Cloud Authentication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_rhem_on_rhel"><a class="anchor" href="#_installing_rhem_on_rhel"></a>Installing RHEM on RHEL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install RHEM on RHEM, you must follow these general steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register your host and entitle it to RHEM.</p>
</li>
<li>
<p>Give your host access to the Red Hat registry.</p>
</li>
<li>
<p>Enable the RHEM package repository and install the RHEM packages.</p>
</li>
<li>
<p>Perform any configurations you need to adhere to your organization&#8217;s production policies, such as configuring an OIDC provider, generating TLS certificates, and opening ports on firewalls.
Some of these affect the RHEM configuation files on <code>/etc/flightctl</code>, others affect different RHEL system services.</p>
</li>
<li>
<p>Start RHEM.</p>
</li>
<li>
<p>Configure users with administrator access to RHEM.</p>
</li>
<li>
<p>Use the web UI or the CLI to validate your RHEM server is healthy and available.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You install RHEM on RHEL by installing its RPM packages, which configure System Daemon (Systemd) units and quadlets.
RHEM can be run without further configuration, most of the times, but there&#8217;s a number of settings you may wish to change for production-grade deployments before starting its services.</p>
</div>
<div class="paragraph">
<p>Before you attempt to install RHEM on RHEL, you must log in to the Red Hat registry (<code>registry.redhat.io</code>) using a valid Red Hat customer portal account, as the root user, or by using a <a href="https://access.redhat.com/articles/RegistryAuthentication#creating-registry-service-accounts-6">Red Hat registry service account</a>.
This step is necessary because RHEM quadlets pull RHEM container images, on their first run, and would fail if there is no registry access token in the container environment of the root user.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For production deployments, it is recommended that you authenticate to the Red Hat registry using service accounts, so you RHEM servers do not store the username and password of a human customer portal user on the local disk.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To install RHEM on RHEL, you must have access to a Red Hat subscription with entitles RHEM and enable, using subcription manager, the package repository channel named <code>edge-manager-1.0-for-rhel-9-x86_64-rpms</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Free Red Hat Developer subscription for individuals and Red Hat Developer subscriptions for teams do not provide entitlements for RHEM.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you could enable the <a href="https://github.com/flightctl/flightctl-rpm" target="_blank" rel="noopener">upstream RPM repository</a> from the Flight Control project, which works for learning purposes, especially given that early releases of RHEM are likely to be functionally equivalent to the RHEM product and have the same version numbers.
In that case, you do not need to log in to the Red Hat registry.</p>
</div>
<div class="paragraph">
<p>Then you install the <code>flightctl-services</code> package, which configures Systemd units for all necessary RHEM microservices.
The same package installs Systemd units to perform one-time initialization of the services which require it.
Finally, you enable and start the <code>flightctl</code> target on Systemd.</p>
</div>
<div class="paragraph">
<p>Additional <code>flightctl-*</code> packages provide optional capabilities, such as the observability microservices, and the CLI, which you can install afterwards or before starting RHEM.</p>
</div>
<div class="paragraph">
<p>If your RHEM server host has firewall services enabled, you should check the product or upstream documentation for the list of TCP ports to open.
You must expose not only the API and web UI ports, but also a few other services, for external network connections.</p>
</div>
<div class="paragraph">
<p>You should expect it, but, anyway, we say it out loud: do not disable SELinux.
RHEM includes a SELinux policy for the targeted mode, as you would expect from any production-grade software.</p>
</div>
<div class="paragraph">
<p>After RHEM services are up and running, you need to create users and groups on the <code>flightctl-pam-issuer</code> container, if you are not using an enterprise OIDC provider, before you can log in on RHEM using either its CLI or web UI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_is_rhem_data_stored"><a class="anchor" href="#_where_is_rhem_data_stored"></a>Where is RHEM data stored?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you start a RHEM server, you will not find a <code>/var/lib/pgsql/data/</code> directory for PostgreSQL data on your RHEM server host.
That directory exists only inside the <code>flightctl-db</code> container, and it is a Podman volume.</p>
</div>
<div class="paragraph">
<p>Similarly, you will not find Redis data directories or API access and audit logs on your RHEM server host.</p>
</div>
<div class="paragraph">
<p>If you must perform RHEM database backups and other database management operations,
you must manage Podman volumes or enter the container namespaces of RHEM containers.</p>
</div>
<div class="paragraph">
<p>Future releases of RHEM will support external databases, so that organization having strict requirements on data management and availability can store RHEM data and managed device state in a database properly configured for their requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s Next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next activity shows how to install and configure a RHEM server, and the next chapter shows how to provision and enroll managed devices on RHEM.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Install Red Hat Edge Manager as Quadlets</a></span>
  <span class="next"><a href="s2-install-lab.html">Lab: Install Red Hat Edge Manager Standalone</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
